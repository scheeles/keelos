syntax = "proto3";

package matic.v1;

service NodeService {
  // Get system health and status
  rpc GetStatus (GetStatusRequest) returns (GetStatusResponse);
  
  // Reboot the node (protected)
  rpc Reboot (RebootRequest) returns (RebootResponse);

  // Install an OS update to the inactive partition
  rpc InstallUpdate (InstallUpdateRequest) returns (stream UpdateProgress);
}

message InstallUpdateRequest {
  // Source of the SquashFS image (URL or local path)
  string source_url = 1;
  // Expected SHA256 checksum (optional)
  string expected_sha256 = 2;
}

message UpdateProgress {
  uint32 percentage = 1;
  string message = 2;
  bool success = 3;
}

message GetStatusRequest {}

message GetStatusResponse {
  string hostname = 1;
  string kernel_version = 2;
  string os_version = 3;
  float uptime_seconds = 4;
}

message RebootRequest {
  // Reason for reboot (audit log)
  string reason = 1;
}

message RebootResponse {
  bool scheduled = 1;
}
